# ğŸ—ï¸ Arquitectura HealthBridge Backend

## Diagrama de Arquitectura de Microservicios

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                          â”‚
â”‚                         FRONTEND (React/Vue)                             â”‚
â”‚                        http://localhost:5173                             â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â”‚ HTTP/HTTPS
                                 â”‚ REST API Calls
                                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                          â”‚
â”‚                      ğŸšª API GATEWAY (Port 3000)                          â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  â€¢ CORS Middleware                                              â”‚   â”‚
â”‚  â”‚  â€¢ Helmet Security                                              â”‚   â”‚
â”‚  â”‚  â€¢ JWT Authentication (Centralizado)                            â”‚   â”‚
â”‚  â”‚  â€¢ Rate Limiting (100 req/15min)                                â”‚   â”‚
â”‚  â”‚  â€¢ Request Tracking & Logging                                   â”‚   â”‚
â”‚  â”‚  â€¢ Health Checks (cada 30s)                                     â”‚   â”‚
â”‚  â”‚  â€¢ Proxy to Microservices                                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                          â”‚
â””â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚
   â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚
   â†“    â†“    â†“    â†“    â†“    â†“    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          MICROSERVICIOS                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚  â”‚  ğŸ” Auth Service     â”‚  â”‚  ğŸ‘¤ User Service     â”‚                      â”‚
â”‚  â”‚  Port: 3001          â”‚  â”‚  Port: 3002          â”‚                      â”‚
â”‚  â”‚  /api/auth           â”‚  â”‚  /api/user           â”‚                      â”‚
â”‚  â”‚                      â”‚  â”‚                      â”‚                      â”‚
â”‚  â”‚  â€¢ Login/Register    â”‚  â”‚  â€¢ User Profiles     â”‚                      â”‚
â”‚  â”‚  â€¢ JWT Generation    â”‚  â”‚  â€¢ CRUD Users        â”‚                      â”‚
â”‚  â”‚  â€¢ Token Refresh     â”‚  â”‚  â€¢ Roles Management  â”‚                      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚  â”‚  ğŸ“… Appointment      â”‚  â”‚  ğŸ“‹ Medical Record   â”‚                      â”‚
â”‚  â”‚  Service             â”‚  â”‚  Service             â”‚                      â”‚
â”‚  â”‚  Port: 3003          â”‚  â”‚  Port: 3004          â”‚                      â”‚
â”‚  â”‚  /api/appointment    â”‚  â”‚  /api/medical-record â”‚                      â”‚
â”‚  â”‚                      â”‚  â”‚                      â”‚                      â”‚
â”‚  â”‚  â€¢ Schedule Appts    â”‚  â”‚  â€¢ Medical History   â”‚                      â”‚
â”‚  â”‚  â€¢ Cancel/Update     â”‚  â”‚  â€¢ File Management   â”‚                      â”‚
â”‚  â”‚  â€¢ Notifications     â”‚  â”‚  â€¢ Prescriptions     â”‚                      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚  â”‚  ğŸ”” Notification     â”‚  â”‚  ğŸ’³ Billing Service  â”‚                      â”‚
â”‚  â”‚  Service             â”‚  â”‚  Port: 3006          â”‚                      â”‚
â”‚  â”‚  Port: 3005          â”‚  â”‚  /api/billing        â”‚                      â”‚
â”‚  â”‚  /api/notification   â”‚  â”‚                      â”‚                      â”‚
â”‚  â”‚                      â”‚  â”‚  â€¢ Invoices          â”‚                      â”‚
â”‚  â”‚  â€¢ Email             â”‚  â”‚  â€¢ Payments          â”‚                      â”‚
â”‚  â”‚  â€¢ SMS               â”‚  â”‚  â€¢ Stripe Integrationâ”‚                      â”‚
â”‚  â”‚  â€¢ Push Notificationsâ”‚  â”‚  â€¢ Receipts          â”‚                      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                â”‚
â”‚  â”‚  ğŸ¯ Subscription     â”‚                                                â”‚
â”‚  â”‚  Service             â”‚                                                â”‚
â”‚  â”‚  Port: 3007          â”‚                                                â”‚
â”‚  â”‚  /api/subscription   â”‚                                                â”‚
â”‚  â”‚                      â”‚                                                â”‚
â”‚  â”‚  â€¢ Plans Management  â”‚                                                â”‚
â”‚  â”‚  â€¢ Freemium Model    â”‚                                                â”‚
â”‚  â”‚  â€¢ Subscriptions     â”‚                                                â”‚
â”‚  â”‚  â€¢ Stripe Integrationâ”‚                                                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                â”‚
â”‚                                                                          â”‚
â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â”‚                    â”‚                      â”‚
   â”‚                    â”‚                      â”‚
   â†“                    â†“                      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           DATA LAYER                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                     ğŸƒ MongoDB Atlas                             â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚   â”‚
â”‚  â”‚  â”‚ healthbridge â”‚  â”‚ healthbridge â”‚  â”‚ healthbridge â”‚         â”‚   â”‚
â”‚  â”‚  â”‚    _auth     â”‚  â”‚    _user     â”‚  â”‚ _appointment â”‚  ...    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  Connection String:                                             â”‚   â”‚
â”‚  â”‚  mongodb+srv://osquimenacho2002_db_user:***@healthbridge...    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                     ğŸ° RabbitMQ (Port 5672)                      â”‚   â”‚
â”‚  â”‚                 Management UI: Port 15672                        â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  â€¢ Message Queue para eventos asÃ­ncronos                        â”‚   â”‚
â”‚  â”‚  â€¢ Notificaciones entre servicios                               â”‚   â”‚
â”‚  â”‚  â€¢ Event-driven architecture                                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Flujo de ComunicaciÃ³n Detallado

### 1ï¸âƒ£ AutenticaciÃ³n (Login)
```
Frontend â†’ API Gateway â†’ Auth Service â†’ MongoDB
                â†“
          JWT Token generado
                â†“
Frontend recibe token
```

### 2ï¸âƒ£ Request Protegida (ej: obtener perfil)
```
Frontend 
  â†’ Headers: Authorization: Bearer <token>
    â†“
API Gateway
  â†’ Verifica JWT con JWT_SECRET
  â†’ AÃ±ade headers: X-User-Id, X-User-Email, X-User-Role
    â†“
User Service
  â†’ Procesa request
  â†’ Accede a MongoDB
    â†“
Response â†’ API Gateway â†’ Frontend
```

### 3ï¸âƒ£ Crear Cita (Appointment)
```
Frontend â†’ API Gateway â†’ Appointment Service
                              â†“
                        Guarda en MongoDB
                              â†“
                        Publica evento en RabbitMQ
                              â†“
                        Notification Service
                              â†“
                        EnvÃ­a email/SMS al paciente
```

### 4ï¸âƒ£ Procesamiento de Pago
```
Frontend â†’ API Gateway â†’ Billing Service
                              â†“
                        Stripe API
                              â†“
                        Guarda invoice en MongoDB
                              â†“
                        Notification Service
                              â†“
                        EnvÃ­a recibo por email
```

---

## ğŸ” Seguridad en Capas

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Capa 1: CORS (Cross-Origin Resource Sharing)               â”‚
â”‚ â€¢ Valida origen de la request                               â”‚
â”‚ â€¢ Permite: localhost:5173, localhost:3000                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Capa 2: Helmet.js (HTTP Security Headers)                  â”‚
â”‚ â€¢ Content Security Policy                                   â”‚
â”‚ â€¢ XSS Protection                                            â”‚
â”‚ â€¢ HSTS (HTTP Strict Transport Security)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Capa 3: Rate Limiting                                       â”‚
â”‚ â€¢ General: 100 requests / 15 minutos                        â”‚
â”‚ â€¢ Auth: 10 intentos / 15 minutos                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Capa 4: JWT Authentication                                  â”‚
â”‚ â€¢ Verifica token con JWT_SECRET                             â”‚
â”‚ â€¢ Valida expiraciÃ³n                                         â”‚
â”‚ â€¢ Extrae userId, email, role                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Capa 5: Role-Based Access Control (RBAC)                   â”‚
â”‚ â€¢ Admin: Acceso total                                       â”‚
â”‚ â€¢ Doctor: Acceso a pacientes y citas                        â”‚
â”‚ â€¢ Paciente: Acceso solo a sus datos                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Monitoring y Observabilidad

### Health Check Hierarchy
```
API Gateway (/health)
    â”œâ”€ Auth Service (3001/health) â”€â”€â”€â”€â”€â”€â”
    â”œâ”€ User Service (3002/health) â”€â”€â”€â”€â”€â”€â”¤
    â”œâ”€ Appointment (3003/health) â”€â”€â”€â”€â”€â”€â”€â”¤
    â”œâ”€ Medical Record (3004/health) â”€â”€â”€â”€â”¼â”€â†’ Overall Status
    â”œâ”€ Notification (3005/health) â”€â”€â”€â”€â”€â”€â”¤   â€¢ healthy
    â”œâ”€ Billing (3006/health) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â€¢ degraded
    â””â”€ Subscription (3007/health) â”€â”€â”€â”€â”€â”€â”˜   â€¢ unhealthy
```

### Logging Strategy
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Winston Logger (API Gateway)                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  combined-YYYY-MM-DD.log    â†’  Todos los logs           â”‚
â”‚  error-YYYY-MM-DD.log       â†’  Solo errores             â”‚
â”‚  http-YYYY-MM-DD.log        â†’  HTTP requests            â”‚
â”‚                                                          â”‚
â”‚  RotaciÃ³n diaria automÃ¡tica                              â”‚
â”‚  Nivel: debug (dev) / info (prod)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—„ï¸ Estructura de Base de Datos

```
MongoDB Atlas Cluster: HealthBridge
â”œâ”€ healthbridge_auth
â”‚  â”œâ”€ users (credenciales, hashes)
â”‚  â””â”€ sessions (refresh tokens)
â”‚
â”œâ”€ healthbridge_user
â”‚  â”œâ”€ profiles (datos personales)
â”‚  â””â”€ roles (permisos)
â”‚
â”œâ”€ healthbridge_appointment
â”‚  â”œâ”€ appointments (citas)
â”‚  â”œâ”€ schedules (disponibilidad)
â”‚  â””â”€ history (historial)
â”‚
â”œâ”€ healthbridge_medical_record
â”‚  â”œâ”€ records (historiales mÃ©dicos)
â”‚  â”œâ”€ files (documentos)
â”‚  â””â”€ prescriptions (recetas)
â”‚
â”œâ”€ healthbridge_notification
â”‚  â”œâ”€ notifications (notificaciones)
â”‚  â”œâ”€ templates (plantillas)
â”‚  â””â”€ logs (registro de envÃ­os)
â”‚
â”œâ”€ healthbridge_billing
â”‚  â”œâ”€ invoices (facturas)
â”‚  â”œâ”€ payments (pagos)
â”‚  â””â”€ receipts (recibos)
â”‚
â””â”€ healthbridge_subscription
   â”œâ”€ plans (planes: basic, premium, enterprise)
   â”œâ”€ subscriptions (suscripciones activas)
   â””â”€ usage (uso y lÃ­mites)
```

---

## ğŸš€ TecnologÃ­as Utilizadas

### Backend Stack
- **Runtime:** Node.js 22.x + TypeScript
- **Framework:** Express 5.x
- **Base de Datos:** MongoDB Atlas
- **Message Broker:** RabbitMQ
- **AutenticaciÃ³n:** JWT (jsonwebtoken)
- **Seguridad:** Helmet, CORS, express-rate-limit
- **Logging:** Winston + Morgan
- **Proxy:** http-proxy-middleware
- **ValidaciÃ³n:** express-validator
- **Payments:** Stripe API

### DevOps
- **Containerization:** Docker + Docker Compose
- **Process Manager:** Nodemon (dev), PM2 (prod)
- **Environment:** dotenv
- **Package Manager:** npm

---

## ğŸ“ˆ Escalabilidad

### Horizontal Scaling
```
                Load Balancer (nginx)
                        â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â†“               â†“               â†“
   Gateway 1       Gateway 2       Gateway 3
        â†“               â†“               â†“
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
                Microservices Layer
                        â†“
                MongoDB Replica Set
```

### Vertical Scaling
- Incrementar recursos de cada servicio
- Optimizar queries a MongoDB
- Implementar caching con Redis

---

## ğŸ¯ Patrones de DiseÃ±o Implementados

1. **API Gateway Pattern** - Punto de entrada Ãºnico
2. **Microservices Architecture** - Servicios independientes
3. **Circuit Breaker** - (Recomendado implementar)
4. **Event-Driven** - RabbitMQ para eventos
5. **Database per Service** - Cada servicio su BD
6. **CQRS** - (Recomendado para medical records)
7. **Saga Pattern** - (Para transacciones distribuidas)

---

## ğŸ“ URLs de Desarrollo

| Servicio | URL |
|----------|-----|
| Frontend | http://localhost:5173 |
| API Gateway | http://localhost:3000 |
| Auth Service | http://localhost:3001 |
| User Service | http://localhost:3002 |
| Appointment Service | http://localhost:3003 |
| Medical Record Service | http://localhost:3004 |
| Notification Service | http://localhost:3005 |
| Billing Service | http://localhost:3006 |
| Subscription Service | http://localhost:3007 |
| RabbitMQ Management | http://localhost:15672 |
| MongoDB Atlas | mongodb+srv://... |

---

**Ãšltima ActualizaciÃ³n:** 23 de octubre de 2025  
**VersiÃ³n:** 1.0.0  
**Mantenido por:** HealthBridge Team
