â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                    HEALTHBRIDGE SUBSCRIPTION SERVICE 
                         GUÃA PARA INTEGRACIÃ“N FRONTEND
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“‹ ÃNDICE
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. INFORMACIÃ“N GENERAL
2. CONFIGURACIÃ“N CORS Y AUTENTICACIÃ“N
3. MODELO FREEMIUM Y PLANES
4. ENDPOINTS - PLANES (PÃºblicos)
5. ENDPOINTS - SUSCRIPCIONES (Autenticados)
6. ENDPOINTS - USO Y LÃMITES (Autenticados)
7. INTEGRACIÃ“N CON STRIPE
8. EJEMPLOS DE USO CON AXIOS
9. MANEJO DE ERRORES
10. NOTAS IMPORTANTES


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
1. INFORMACIÃ“N GENERAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ”— URLs BASE:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ Gateway (Recomendado): http://localhost:3000/api/subscription
â€¢ Servicio Directo (Dev): http://localhost:3007

ğŸ—„ï¸ BASE DE DATOS:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ MongoDB: healthbridge-subscriptions
â€¢ Colecciones:
  - plans: Planes disponibles (Basic, Premium, Enterprise)
  - subscriptions: Suscripciones de usuarios
  - usagetrackings: Tracking de uso mensual por usuario

ğŸ”‘ PUERTO:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ 3007

ğŸ’³ PROCESADOR DE PAGOS:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ Stripe (para pagos online)
â€¢ Modos: Test (desarrollo) / Live (producciÃ³n)


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
2. CONFIGURACIÃ“N CORS Y AUTENTICACIÃ“N
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ”’ AUTENTICACIÃ“N:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ Tipo: JWT Bearer Token
â€¢ Header requerido:
  Authorization: Bearer <access_token>

âš ï¸ NOTA: Solo los endpoints de /plans son PÃšBLICOS, todo lo demÃ¡s requiere token

ğŸŒ CORS:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ OrÃ­genes permitidos: http://localhost:5173, http://localhost:3000
â€¢ Headers permitidos: Content-Type, Authorization
â€¢ MÃ©todos: GET, POST, PUT, DELETE, OPTIONS


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
3. MODELO FREEMIUM Y PLANES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“Š PLANES DISPONIBLES:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     FEATURE       â”‚     BASIC     â”‚    PREMIUM    â”‚   ENTERPRISE    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Precio            â”‚ Bs. 0 (Gratis)â”‚   Bs. 50/mes  â”‚   Bs. 120/mes   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Citas/mes         â”‚       2       â”‚      10       â”‚    â™¾ï¸ Ilimitado â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Almacenamiento    â”‚   100 MB      â”‚    500 MB     â”‚    â™¾ï¸ Ilimitado â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Archivos/registro â”‚       1       â”‚       5       â”‚    â™¾ï¸ Ilimitado â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Telemedicina      â”‚      âŒ       â”‚    âœ… BÃ¡sica  â”‚   âœ… Premium    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Acceso API        â”‚      âŒ       â”‚      âŒ       â”‚       âœ…        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Multi-clÃ­nica     â”‚      âŒ       â”‚      âŒ       â”‚       âœ…        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Notificaciones    â”‚ Email + Push  â”‚ Email+SMS+Pushâ”‚ Email+SMS+Push  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Reportes avanzadosâ”‚      âŒ       â”‚      âŒ       â”‚       âœ…        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Branding custom   â”‚      âŒ       â”‚      âŒ       â”‚       âœ…        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Soporte           â”‚ Email (48h)   â”‚ Prioritario   â”‚      24/7       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ’¡ JERARQUÃA DE PLANES:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
basic < premium < enterprise

ğŸ”„ CAMBIOS DE PLAN:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ Upgrade: Inmediato (se cobra la diferencia prorrateada)
â€¢ Downgrade: Al final del perÃ­odo actual (acceso premium hasta la fecha de fin)


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
4. ENDPOINTS - PLANES (PÃšBLICOS - Sin autenticaciÃ³n)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ“Œ 4.1. OBTENER TODOS LOS PLANES
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
GET /api/plans

Headers:
  (ninguno requerido)

Response 200:
{
  "success": true,
  "count": 3,
  "plans": [
    {
      "_id": "plan_id_1",
      "name": "Plan BÃ¡sico",
      "type": "basic",
      "price": 0,
      "currency": "BOB",
      "billingPeriod": "monthly",
      "features": [
        "2 citas por mes",
        "100MB de almacenamiento",
        "1 archivo por registro",
        "Notificaciones por email",
        "Soporte por email (48h)"
      ],
      "limits": {
        "appointments": 2,
        "storage": 104857600,        // en bytes (100MB)
        "filesPerRecord": 1
      },
      "isActive": true
    },
    {
      "_id": "plan_id_2",
      "name": "Plan Premium",
      "type": "premium",
      "price": 50,
      "currency": "BOB",
      "billingPeriod": "monthly",
      "features": [
        "10 citas por mes",
        "500MB de almacenamiento",
        "5 archivos por registro",
        "Teleconsultas bÃ¡sicas",
        "Notificaciones SMS + Email + Push",
        "Soporte prioritario (24h)"
      ],
      "limits": {
        "appointments": 10,
        "storage": 524288000,        // en bytes (500MB)
        "filesPerRecord": 5
      },
      "isActive": true
    },
    {
      "_id": "plan_id_3",
      "name": "Plan Enterprise",
      "type": "enterprise",
      "price": 120,
      "currency": "BOB",
      "billingPeriod": "monthly",
      "features": [
        "Citas ilimitadas",
        "Almacenamiento ilimitado",
        "Archivos ilimitados",
        "Teleconsultas premium (HD + grabaciÃ³n)",
        "API completa",
        "Multi-clÃ­nica",
        "Reportes avanzados",
        "Soporte 24/7",
        "Branding personalizado"
      ],
      "limits": {
        "appointments": -1,          // -1 = ilimitado
        "storage": -1,
        "filesPerRecord": -1
      },
      "isActive": true
    }
  ]
}

Errores:
  500: Error interno del servidor


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ“Œ 4.2. OBTENER PLAN ESPECÃFICO
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
GET /api/plans/:type

Params:
  type: "basic" | "premium" | "enterprise"

Ejemplo: GET /api/plans/premium

Response 200:
{
  "success": true,
  "plan": {
    "_id": "plan_id_2",
    "name": "Plan Premium",
    "type": "premium",
    "price": 50,
    "currency": "BOB",
    "billingPeriod": "monthly",
    "features": [...],
    "limits": {
      "appointments": 10,
      "storage": 524288000,
      "filesPerRecord": 5
    },
    "isActive": true
  }
}

Errores:
  404: Plan no encontrado
  500: Error interno del servidor


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
5. ENDPOINTS - SUSCRIPCIONES (REQUIEREN AUTENTICACIÃ“N)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ“Œ 5.1. OBTENER MI SUSCRIPCIÃ“N ACTUAL
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
GET /api/subscription/my-subscription

Headers:
  Authorization: Bearer <access_token>

Response 200:
{
  "subscription": {
    "_id": "sub_id_123",
    "userId": "user_id_456",
    "planType": "premium",
    "status": "active",           // "active" | "cancelled" | "expired" | "trial"
    "startDate": "2025-01-01T00:00:00.000Z",
    "endDate": "2025-02-01T00:00:00.000Z",
    "autoRenew": true,
    "paymentMethod": "stripe",    // "stripe" | "cash" | "bank_transfer"
    "stripeCustomerId": "cus_xxxxx",
    "stripeSubscriptionId": "sub_xxxxx",
    "lastPaymentDate": "2025-01-01T00:00:00.000Z",
    "nextPaymentDate": "2025-02-01T00:00:00.000Z",
    "cancelledAt": null,
    "cancellationReason": null,
    "metadata": {}
  },
  "usage": {
    "userId": "user_id_456",
    "period": {
      "month": 1,
      "year": 2025
    },
    "usage": {
      "appointments": {
        "count": 5,
        "limit": 10
      },
      "storage": {
        "usedMB": 120,
        "limitMB": 500
      },
      "apiCalls": {
        "count": 0,
        "limit": 0
      }
    },
    "lastUpdated": "2025-01-15T10:30:00.000Z"
  }
}

Errores:
  401: Token no proporcionado o invÃ¡lido
  404: SuscripciÃ³n no encontrada (usuario no tiene suscripciÃ³n)
  500: Error interno del servidor


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ“Œ 5.2. CREAR SUSCRIPCIÃ“N
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
POST /api/subscription

Headers:
  Authorization: Bearer <access_token>
  Content-Type: application/json

Body:
{
  "planType": "premium",         // "basic" | "premium" | "enterprise"
  "paymentMethod": "stripe"      // "stripe" | "cash" | "bank_transfer"
}

Response 201:
{
  "message": "SuscripciÃ³n creada exitosamente",
  "subscription": {
    "_id": "sub_id_789",
    "userId": "user_id_456",
    "planType": "premium",
    "status": "active",
    "startDate": "2025-01-20T00:00:00.000Z",
    "endDate": "2025-02-20T00:00:00.000Z",
    "autoRenew": false,
    "paymentMethod": "stripe",
    "stripeCustomerId": "cus_xxxxx",
    "metadata": {}
  }
}

âš ï¸ NOTA: Si planType es "premium" o "enterprise", necesitarÃ¡s completar el pago
         en Stripe usando el checkout session (ver secciÃ³n 7)

Errores:
  400: Plan type requerido o invÃ¡lido
  401: Usuario no autenticado
  409: El usuario ya tiene una suscripciÃ³n activa
  500: Error interno del servidor


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ“Œ 5.3. UPGRADE DE SUSCRIPCIÃ“N
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
POST /api/subscription/upgrade

Headers:
  Authorization: Bearer <access_token>
  Content-Type: application/json

Body:
{
  "planType": "enterprise"       // Plan superior al actual
}

Response 200:
{
  "message": "SuscripciÃ³n actualizada exitosamente",
  "subscription": {
    "_id": "sub_id_789",
    "userId": "user_id_456",
    "planType": "enterprise",
    "status": "active",
    "startDate": "2025-01-01T00:00:00.000Z",
    "endDate": "2025-02-01T00:00:00.000Z",    // se mantiene la fecha original
    "autoRenew": true,
    "paymentMethod": "stripe",
    "metadata": {
      "upgradedFrom": "premium",
      "upgradedAt": "2025-01-20T10:00:00.000Z"
    }
  }
}

ğŸ’¡ LÃ“GICA DE UPGRADE:
â€¢ Upgrade es INMEDIATO
â€¢ Se cobra la diferencia prorrateada entre planes
â€¢ El endDate se mantiene igual (no se extiende)

Errores:
  400: Nuevo plan requerido o invÃ¡lido
  401: Usuario no autenticado
  403: No puedes hacer upgrade (ya estÃ¡s en el plan mÃ¡s alto o no hay suscripciÃ³n)
  500: Error interno del servidor


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ“Œ 5.4. DOWNGRADE DE SUSCRIPCIÃ“N
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
POST /api/subscription/downgrade

Headers:
  Authorization: Bearer <access_token>
  Content-Type: application/json

Body:
{
  "planType": "basic"            // Plan inferior al actual
}

Response 200:
{
  "message": "Downgrade programado exitosamente",
  "subscription": {
    "_id": "sub_id_789",
    "userId": "user_id_456",
    "planType": "premium",       // âš ï¸ Sigue siendo premium hasta endDate
    "status": "active",
    "startDate": "2025-01-01T00:00:00.000Z",
    "endDate": "2025-02-01T00:00:00.000Z",
    "autoRenew": true,
    "paymentMethod": "stripe",
    "metadata": {
      "scheduledDowngradeTo": "basic",
      "downgradeDate": "2025-02-01T00:00:00.000Z"
    }
  }
}

ğŸ’¡ LÃ“GICA DE DOWNGRADE:
â€¢ Downgrade es AL FINAL DEL PERÃODO ACTUAL
â€¢ El usuario mantiene acceso al plan actual hasta endDate
â€¢ Un cron job aplicarÃ¡ el cambio automÃ¡ticamente en endDate

Errores:
  400: Nuevo plan requerido o invÃ¡lido
  401: Usuario no autenticado
  403: No puedes hacer downgrade (ya estÃ¡s en el plan mÃ¡s bajo)
  500: Error interno del servidor


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ“Œ 5.5. CANCELAR SUSCRIPCIÃ“N
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
POST /api/subscription/cancel

Headers:
  Authorization: Bearer <access_token>
  Content-Type: application/json

Body:
{
  "reason": "No lo uso suficiente",           // opcional
  "feedback": "El servicio es bueno pero..."  // opcional
}

Response 200:
{
  "message": "SuscripciÃ³n cancelada exitosamente",
  "subscription": {
    "_id": "sub_id_789",
    "userId": "user_id_456",
    "planType": "premium",
    "status": "cancelled",
    "startDate": "2025-01-01T00:00:00.000Z",
    "endDate": "2025-02-01T00:00:00.000Z",    // tendrÃ¡s acceso hasta aquÃ­
    "autoRenew": false,
    "cancelledAt": "2025-01-20T15:00:00.000Z",
    "cancellationReason": "No lo uso suficiente",
    "metadata": {
      "feedback": "El servicio es bueno pero..."
    }
  }
}

ğŸ’¡ LÃ“GICA DE CANCELACIÃ“N:
â€¢ El usuario mantiene acceso hasta endDate
â€¢ No se cobra el siguiente perÃ­odo
â€¢ Se guarda la razÃ³n para analytics
â€¢ Un cron job cambiarÃ¡ el status a "expired" al llegar a endDate

Errores:
  401: Usuario no autenticado
  404: No se encontrÃ³ suscripciÃ³n activa
  500: Error interno del servidor


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ“Œ 5.6. CREAR CHECKOUT SESSION DE STRIPE
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
POST /api/subscription/checkout-session

Headers:
  Authorization: Bearer <access_token>
  Content-Type: application/json

Body:
{
  "priceId": "price_xxxxx"       // Stripe Price ID del plan
}

Response 200:
{
  "sessionId": "cs_test_xxxxx",
  "url": "https://checkout.stripe.com/pay/cs_test_xxxxx"
}

ğŸ’¡ USO: Redirige al usuario a la URL para completar el pago en Stripe

Errores:
  400: Price ID requerido
  401: Usuario no autenticado
  500: Error interno del servidor


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
6. ENDPOINTS - USO Y LÃMITES (REQUIEREN AUTENTICACIÃ“N)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ“Œ 6.1. OBTENER USO ACTUAL DEL MES
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
GET /api/usage/current

Headers:
  Authorization: Bearer <access_token>

Response 200:
{
  "success": true,
  "usage": {
    "userId": "user_id_456",
    "period": {
      "month": 1,
      "year": 2025
    },
    "usage": {
      "appointments": {
        "count": 7,
        "limit": 10
      },
      "storage": {
        "usedMB": 245,
        "limitMB": 500
      },
      "apiCalls": {
        "count": 0,
        "limit": 0
      }
    },
    "lastUpdated": "2025-01-20T10:30:00.000Z"
  }
}

âš ï¸ IMPORTANTE:
â€¢ Este endpoint devuelve el uso del mes ACTUAL
â€¢ Si el usuario no tiene registro de uso, se crea automÃ¡ticamente
â€¢ Los lÃ­mites se toman del plan actual del usuario

Errores:
  401: Usuario no autenticado
  500: Error interno del servidor


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ“Œ 6.2. VERIFICAR LÃMITE DE UNA FUNCIONALIDAD
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
GET /api/usage/check/:feature

Headers:
  Authorization: Bearer <access_token>

Params:
  feature: "appointments" | "storage" | "apiCalls"

Ejemplo: GET /api/usage/check/appointments

Response 200 (Permitido):
{
  "success": true,
  "allowed": true,
  "used": 5,
  "limit": 10,
  "remaining": 5,
  "feature": "appointments"
}

Response 200 (LÃ­mite alcanzado):
{
  "success": false,
  "allowed": false,
  "message": "Has alcanzado el lÃ­mite de citas para tu plan Basic",
  "used": 2,
  "limit": 2,
  "remaining": 0,
  "feature": "appointments",
  "suggestedPlan": "premium",    // Plan sugerido para upgrade
  "suggestedPlanLimit": 10
}

ğŸ’¡ USO:
â€¢ Llama a este endpoint ANTES de permitir una acciÃ³n (crear cita, subir archivo)
â€¢ Si allowed = false, muestra un mensaje al usuario sugiriendo upgrade

Errores:
  400: Feature invÃ¡lida
  401: Usuario no autenticado
  404: No se encontrÃ³ uso o suscripciÃ³n del usuario
  500: Error interno del servidor


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ“Œ 6.3. REGISTRAR USO DE UNA FUNCIONALIDAD
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
POST /api/usage/track

Headers:
  Authorization: Bearer <access_token>
  Content-Type: application/json

Body:
{
  "type": "appointment",         // "appointment" | "storage" | "apiCall"
  "metadata": {
    "appointmentId": "appt_123",  // opcional: metadatos adicionales
    "action": "created"
  }
}

Response 200:
{
  "success": true,
  "message": "Uso registrado exitosamente",
  "usage": {
    "appointments": {
      "count": 6,
      "limit": 10,
      "remaining": 4
    }
  }
}

Response 403 (LÃ­mite excedido):
{
  "success": false,
  "error": "LÃ­mite excedido",
  "message": "Has alcanzado el lÃ­mite de citas para tu plan",
  "suggestedPlan": "premium"
}

ğŸ’¡ USO:
â€¢ Llama a este endpoint DESPUÃ‰S de completar una acciÃ³n exitosamente
â€¢ Para storage, el metadata debe incluir { "sizeMB": 5 }
â€¢ Este endpoint es principalmente para uso INTERNO entre servicios

Errores:
  400: Tipo de uso invÃ¡lido
  401: Usuario no autenticado
  403: LÃ­mite excedido
  500: Error interno del servidor


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
7. INTEGRACIÃ“N CON STRIPE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ”— FLUJO DE PAGO CON STRIPE:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1ï¸âƒ£ Frontend: Usuario selecciona un plan Premium o Enterprise
   
2ï¸âƒ£ Frontend: Llama a POST /api/subscription/checkout-session
   Body: { "priceId": "price_xxxxx" }
   
3ï¸âƒ£ Backend: Crea Checkout Session en Stripe y devuelve URL

4ï¸âƒ£ Frontend: Redirige al usuario a la URL de Stripe

5ï¸âƒ£ Usuario: Completa el pago en Stripe

6ï¸âƒ£ Stripe: EnvÃ­a webhook a POST /api/subscription/webhook

7ï¸âƒ£ Backend: Actualiza la suscripciÃ³n del usuario automÃ¡ticamente

8ï¸âƒ£ Stripe: Redirige al usuario de vuelta a tu app (success_url)

9ï¸âƒ£ Frontend: Muestra mensaje de Ã©xito y recarga la suscripciÃ³n


ğŸ“Œ WEBHOOK DE STRIPE:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
POST /api/subscription/webhook

âš ï¸ IMPORTANTE:
â€¢ Este endpoint es SOLO para Stripe
â€¢ NO requiere autenticaciÃ³n JWT
â€¢ Requiere firma de Stripe en header "stripe-signature"
â€¢ NO debes llamar a este endpoint desde el frontend

Eventos procesados:
â€¢ checkout.session.completed: Pago completado
â€¢ customer.subscription.updated: SuscripciÃ³n actualizada
â€¢ customer.subscription.deleted: SuscripciÃ³n cancelada


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
8. EJEMPLOS DE USO CON AXIOS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ“Œ 8.1. SETUP DE AXIOS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// src/api/subscriptionService.js
import axios from 'axios';

const API_URL = 'http://localhost:3000/api';

const subscriptionApi = axios.create({
  baseURL: `${API_URL}/subscription`,
  headers: {
    'Content-Type': 'application/json'
  }
});

const planApi = axios.create({
  baseURL: `${API_URL}/plans`,
  headers: {
    'Content-Type': 'application/json'
  }
});

const usageApi = axios.create({
  baseURL: `${API_URL}/usage`,
  headers: {
    'Content-Type': 'application/json'
  }
});

// Interceptor para aÃ±adir token automÃ¡ticamente
[subscriptionApi, usageApi].forEach(api => {
  api.interceptors.request.use(
    (config) => {
      const token = localStorage.getItem('accessToken');
      if (token) {
        config.headers.Authorization = `Bearer ${token}`;
      }
      return config;
    },
    (error) => Promise.reject(error)
  );
});


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ“Œ 8.2. OBTENER TODOS LOS PLANES (PÃºblico)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Obtener todos los planes disponibles
export const getAllPlans = async () => {
  try {
    const response = await planApi.get('/');
    return response.data;
  } catch (error) {
    console.error('Error obteniendo planes:', error);
    throw error;
  }
};

// Uso en componente React
import { useEffect, useState } from 'react';
import { getAllPlans } from '@/api/subscriptionService';

function PricingPage() {
  const [plans, setPlans] = useState([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const fetchPlans = async () => {
      try {
        const data = await getAllPlans();
        setPlans(data.plans);
      } catch (error) {
        console.error('Error:', error);
      } finally {
        setLoading(false);
      }
    };

    fetchPlans();
  }, []);

  if (loading) return <div>Cargando planes...</div>;

  return (
    <div className="pricing-grid">
      {plans.map(plan => (
        <PlanCard key={plan._id} plan={plan} />
      ))}
    </div>
  );
}


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ“Œ 8.3. OBTENER MI SUSCRIPCIÃ“N ACTUAL
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Obtener suscripciÃ³n del usuario autenticado
export const getMySubscription = async () => {
  try {
    const response = await subscriptionApi.get('/my-subscription');
    return response.data;
  } catch (error) {
    if (error.response?.status === 404) {
      // Usuario no tiene suscripciÃ³n
      return null;
    }
    throw error;
  }
};

// Uso en componente
import { getMySubscription } from '@/api/subscriptionService';

function DashboardPage() {
  const [subscription, setSubscription] = useState(null);
  const [usage, setUsage] = useState(null);

  useEffect(() => {
    const fetchSubscription = async () => {
      try {
        const data = await getMySubscription();
        if (data) {
          setSubscription(data.subscription);
          setUsage(data.usage);
        }
      } catch (error) {
        console.error('Error:', error);
      }
    };

    fetchSubscription();
  }, []);

  return (
    <div>
      <h2>Mi Plan: {subscription?.planType || 'Ninguno'}</h2>
      <p>Estado: {subscription?.status}</p>
      
      <h3>Uso del mes:</h3>
      <p>Citas: {usage?.usage.appointments.count} / {usage?.usage.appointments.limit}</p>
      <p>Almacenamiento: {usage?.usage.storage.usedMB}MB / {usage?.usage.storage.limitMB}MB</p>
    </div>
  );
}


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ“Œ 8.4. CREAR SUSCRIPCIÃ“N
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Crear nueva suscripciÃ³n
export const createSubscription = async (planType, paymentMethod = 'stripe') => {
  try {
    const response = await subscriptionApi.post('/', {
      planType,
      paymentMethod
    });
    return response.data;
  } catch (error) {
    if (error.response?.status === 409) {
      throw new Error('Ya tienes una suscripciÃ³n activa');
    }
    throw error;
  }
};

// Uso en componente
import { createSubscription } from '@/api/subscriptionService';

function UpgradeButton({ planType }) {
  const [loading, setLoading] = useState(false);

  const handleUpgrade = async () => {
    setLoading(true);
    try {
      const result = await createSubscription(planType);
      alert('Â¡SuscripciÃ³n creada exitosamente!');
      // Redirigir o refrescar
    } catch (error) {
      alert(error.message || 'Error al crear suscripciÃ³n');
    } finally {
      setLoading(false);
    }
  };

  return (
    <button onClick={handleUpgrade} disabled={loading}>
      {loading ? 'Procesando...' : `Suscribirse a ${planType}`}
    </button>
  );
}


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ“Œ 8.5. HACER UPGRADE CON PAGO EN STRIPE
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Upgrade a plan superior
export const upgradeSubscription = async (planType) => {
  try {
    const response = await subscriptionApi.post('/upgrade', {
      planType
    });
    return response.data;
  } catch (error) {
    throw error;
  }
};

// Crear checkout session
export const createCheckoutSession = async (priceId) => {
  try {
    const response = await subscriptionApi.post('/checkout-session', {
      priceId
    });
    return response.data;
  } catch (error) {
    throw error;
  }
};

// Uso en componente
import { upgradeSubscription, createCheckoutSession } from '@/api/subscriptionService';

function UpgradeModal({ currentPlan, targetPlan }) {
  const handleUpgrade = async () => {
    try {
      // 1. Iniciar upgrade (crea intenciÃ³n en backend)
      await upgradeSubscription(targetPlan.type);

      // 2. Si el plan requiere pago, crear checkout session
      if (targetPlan.price > 0) {
        const { url } = await createCheckoutSession(targetPlan.stripePriceId);
        
        // 3. Redirigir a Stripe
        window.location.href = url;
      } else {
        // Plan gratuito, redirigir a dashboard
        window.location.href = '/dashboard';
      }
    } catch (error) {
      alert('Error al procesar upgrade: ' + error.message);
    }
  };

  return (
    <div className="modal">
      <h2>Upgrade a {targetPlan.name}</h2>
      <p>Precio: Bs. {targetPlan.price}/mes</p>
      <button onClick={handleUpgrade}>Confirmar Upgrade</button>
    </div>
  );
}


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ“Œ 8.6. VERIFICAR LÃMITE ANTES DE ACCIÃ“N
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Verificar si el usuario puede realizar una acciÃ³n
export const checkLimit = async (feature) => {
  try {
    const response = await usageApi.get(`/check/${feature}`);
    return response.data;
  } catch (error) {
    throw error;
  }
};

// Uso en componente - Verificar antes de crear cita
import { checkLimit } from '@/api/subscriptionService';

function CreateAppointmentButton() {
  const [canCreate, setCanCreate] = useState(true);
  const [limitInfo, setLimitInfo] = useState(null);

  useEffect(() => {
    const verifyLimit = async () => {
      try {
        const result = await checkLimit('appointments');
        setCanCreate(result.allowed);
        setLimitInfo(result);
      } catch (error) {
        console.error('Error verificando lÃ­mite:', error);
      }
    };

    verifyLimit();
  }, []);

  const handleClick = () => {
    if (!canCreate) {
      alert(
        `Has alcanzado el lÃ­mite de ${limitInfo.limit} citas para tu plan. ` +
        `Considera hacer upgrade a ${limitInfo.suggestedPlan}.`
      );
      return;
    }

    // Proceder con la creaciÃ³n de cita
    createAppointment();
  };

  return (
    <div>
      <button onClick={handleClick} disabled={!canCreate}>
        {canCreate 
          ? `Crear Cita (${limitInfo?.remaining} restantes)` 
          : 'LÃ­mite alcanzado - Upgrade requerido'
        }
      </button>
    </div>
  );
}


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ“Œ 8.7. CANCELAR SUSCRIPCIÃ“N
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Cancelar suscripciÃ³n actual
export const cancelSubscription = async (reason, feedback) => {
  try {
    const response = await subscriptionApi.post('/cancel', {
      reason,
      feedback
    });
    return response.data;
  } catch (error) {
    throw error;
  }
};

// Uso en componente
import { cancelSubscription } from '@/api/subscriptionService';

function CancelSubscriptionModal({ subscription, onClose }) {
  const [reason, setReason] = useState('');
  const [feedback, setFeedback] = useState('');
  const [loading, setLoading] = useState(false);

  const handleCancel = async () => {
    setLoading(true);
    try {
      const result = await cancelSubscription(reason, feedback);
      alert(
        `SuscripciÃ³n cancelada. TendrÃ¡s acceso hasta ${
          new Date(result.subscription.endDate).toLocaleDateString()
        }`
      );
      onClose();
    } catch (error) {
      alert('Error al cancelar: ' + error.message);
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="modal">
      <h2>Cancelar SuscripciÃ³n</h2>
      
      <label>
        Â¿Por quÃ© cancelas?
        <select value={reason} onChange={e => setReason(e.target.value)}>
          <option value="">Selecciona...</option>
          <option value="too_expensive">Muy caro</option>
          <option value="not_using">No lo uso suficiente</option>
          <option value="missing_features">Falta funcionalidades</option>
          <option value="technical_issues">Problemas tÃ©cnicos</option>
          <option value="other">Otro</option>
        </select>
      </label>

      <label>
        Comentarios adicionales (opcional):
        <textarea 
          value={feedback} 
          onChange={e => setFeedback(e.target.value)}
          placeholder="AyÃºdanos a mejorar..."
        />
      </label>

      <div className="actions">
        <button onClick={onClose}>Volver</button>
        <button onClick={handleCancel} disabled={loading || !reason}>
          {loading ? 'Cancelando...' : 'Confirmar CancelaciÃ³n'}
        </button>
      </div>
    </div>
  );
}


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
9. MANEJO DE ERRORES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ”´ CÃ“DIGOS DE ERROR:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ 400: Bad Request - Datos invÃ¡lidos o faltantes
â€¢ 401: Unauthorized - Token no proporcionado o invÃ¡lido
â€¢ 403: Forbidden - Sin permisos o lÃ­mite excedido
â€¢ 404: Not Found - Recurso no encontrado
â€¢ 409: Conflict - El recurso ya existe
â€¢ 500: Internal Server Error - Error del servidor

ğŸ“‹ ESTRUCTURA DE ERRORES:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
{
  "error": "DescripciÃ³n breve del error",
  "message": "Mensaje detallado para el usuario",
  "suggestedPlan": "premium"  // solo en errores de lÃ­mite
}

ğŸ›¡ï¸ MANEJO RECOMENDADO:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Interceptor global de errores
subscriptionApi.interceptors.response.use(
  (response) => response,
  (error) => {
    if (error.response) {
      const { status, data } = error.response;

      switch (status) {
        case 401:
          // Token expirado, redirigir a login
          localStorage.removeItem('accessToken');
          window.location.href = '/login';
          break;

        case 403:
          // LÃ­mite excedido
          if (data.suggestedPlan) {
            // Mostrar modal de upgrade
            showUpgradeModal(data.suggestedPlan, data.message);
          }
          break;

        case 404:
          // Usuario sin suscripciÃ³n
          if (data.error === 'SuscripciÃ³n no encontrada') {
            // Redirigir a pÃ¡gina de planes
            window.location.href = '/pricing';
          }
          break;

        case 500:
          // Error del servidor
          alert('Error del servidor. Por favor intenta de nuevo.');
          break;
      }
    }

    return Promise.reject(error);
  }
);


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
10. NOTAS IMPORTANTES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âš ï¸ LIMITACIONES DEL PLAN:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ Los lÃ­mites se aplican por MES CALENDARIO (se resetean el dÃ­a 1 de cada mes)
â€¢ El valor -1 en los lÃ­mites significa ILIMITADO
â€¢ Los upgrades son inmediatos, los downgrades son al final del perÃ­odo

ğŸ”„ RENOVACIÃ“N AUTOMÃTICA:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ Si autoRenew = true, la suscripciÃ³n se renueva automÃ¡ticamente
â€¢ Si autoRenew = false, la suscripciÃ³n expira al llegar a endDate
â€¢ Un cron job procesa las renovaciones diariamente

ğŸ’³ PAGOS CON STRIPE:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ Usar Stripe Checkout para una integraciÃ³n segura
â€¢ El backend maneja webhooks automÃ¡ticamente
â€¢ NUNCA manejar informaciÃ³n de tarjetas directamente
â€¢ En desarrollo usar tarjeta de prueba: 4242 4242 4242 4242

ğŸ” SEGURIDAD:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ Todos los endpoints (excepto /plans) requieren JWT token
â€¢ El webhook de Stripe valida la firma automÃ¡ticamente
â€¢ No expongas STRIPE_SECRET_KEY en el frontend
â€¢ Usa HTTPS en producciÃ³n

ğŸ“Š MONITOREO DE USO:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ Verifica lÃ­mites ANTES de permitir acciones
â€¢ Registra uso DESPUÃ‰S de acciones exitosas
â€¢ Muestra uso restante al usuario de forma visible
â€¢ Sugiere upgrade cuando se acerque al lÃ­mite

ğŸ¨ UX RECOMENDADA:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ Mostrar barra de progreso del uso (ej: "7/10 citas usadas")
â€¢ Deshabilitar botones cuando lÃ­mite alcanzado
â€¢ Mostrar modal de upgrade cuando intente exceder lÃ­mite
â€¢ Indicar claramente los beneficios de cada plan
â€¢ Permitir cancelaciÃ³n fÃ¡cil (con feedback)

ğŸ”” NOTIFICACIONES:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ Notificar al usuario cuando alcance 80% del lÃ­mite
â€¢ Enviar recordatorio antes de renovaciÃ³n
â€¢ Confirmar upgrade/downgrade/cancelaciÃ³n por email
â€¢ Avisar cuando una suscripciÃ³n estÃ© por expirar

ğŸ§ª TESTING:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ Usar modo TEST de Stripe en desarrollo
â€¢ Tarjeta de prueba: 4242 4242 4242 4242
â€¢ Webhook testing con Stripe CLI: stripe listen --forward-to localhost:3007/api/subscription/webhook
â€¢ Verificar que los lÃ­mites se apliquen correctamente

ğŸ“ SOPORTE:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ Para problemas con pagos, revisar logs de Stripe
â€¢ Para problemas con lÃ­mites, verificar UsageTracking en MongoDB
â€¢ Para errores de webhook, verificar STRIPE_WEBHOOK_SECRET


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                              FIN DEL DOCUMENTO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ‰ Â¡GuÃ­a completa del Subscription Service!

Esta documentaciÃ³n cubre todo lo necesario para integrar el sistema de
suscripciones Freemium en tu frontend de HealthBridge.

Si tienes dudas adicionales, consulta:
â€¢ README.md del subscription-service
â€¢ DocumentaciÃ³n de Stripe: https://stripe.com/docs
â€¢ Logs del servicio en logs/combined.log
